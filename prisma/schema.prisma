generator client {
  provider = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id          String    @id @default(cuid())
  username    String    @unique
  password    String
  name        String?
  signature   String?   // Base64 signature image
  role        String    @default("USER") // "ADMIN", "USER"
  approved    Boolean   @default(false)
  isActive    Boolean   @default(true)  // New: For soft delete / passive mode
  approvedBy  String?
  approvedAt  DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  reports     ServiceReport[]
}

model ServiceReport {
  id            String    @id @default(cuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  siteName      String    // Şantiye Adı
  siteColor     String?   // Şantiye Rengi (Hex code)
  
  startDate     DateTime
  endDate       DateTime
  
  // Storing as JSON string or comma separated for simplicity in SQLite 
  // or a relation if we want to be strict, but simpler is better here.
  // We'll trust the app to handle the JSON array of excluded dates.
  // We'll trust the app to handle the JSON array of excluded dates.
  excludedDates String?   // JSON string: ["2026-01-01", "2026-01-02"]
  holidays      String?   // JSON string: ["2026-04-23", "2026-05-19"]
  
  summaryNotes  String?

  workerSignature String? // Base64 or path to image

  totalWorkingDays Int       @default(0)
  extraTime50      Float     @default(0)
  extraTime100     Float     @default(0)
  holidayTime100   Float     @default(0)

  advances      Advance[]
  expenses      Expense[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  attachments   ReportAttachment[]
}

model ReportAttachment {
  id        String        @id @default(cuid())
  reportId  String
  report    ServiceReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  
  fileName  String
  filePath  String        // Relative path in public/uploads or equivalent
  fileType  String        // mime type
  fileSize  Int
  
  createdAt DateTime      @default(now())
}

model Advance {
  id        String        @id @default(cuid())
  reportId  String
  report    ServiceReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  
  amount    Float
  currency  String        // "TL", "USD", "EUR"
  note      String?
}

model Expense {
  id          String        @id @default(cuid())
  reportId    String
  report      ServiceReport @relation(fields: [reportId], references: [id], onDelete: Cascade)
  
  amount      Float
  currency    String        // "TL", "USD", "EUR"
  description String
}

model OfficialHoliday {
  id          String   @id @default(cuid())
  date        DateTime @unique
  description String
  isHalfDay   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model SiteSettings {
  id          String   @id @default(cuid())
  siteName    String   @default("ERMAK Rapor")
  description String   @default("Servis Raporlama Sistemi")
  contactEmail String?
  contactPhone String?
  aboutText   String   @default("") // HTML or Markdown content
  enableThemeSwitch Boolean @default(true)
  debugMode   Boolean  @default(false)
  updatedAt   DateTime @updatedAt
}
